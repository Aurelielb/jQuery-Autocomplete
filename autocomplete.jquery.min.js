/**
 * jQuery auto complete plugin
 *
 * @desc create a list of suggestions with ajax while typing
 * @version 1
 * @author AurÃ©lie Le Bouguennec
 * @licenses Creative Commons BY-SA 2.0
 * @see https://github.com/Aurelielb/jQuery-Autocomplete
 *
 */
;(function(t){var n={oInput:null,oList:null,oldText:"",oSelected:null,keys:{ESC:27,TAB:9,RETURN:13,UP:38,DOWN:40},tempSelectionClass:"temp",typingTimer:null};var r={minLength:null,source:null,onCreate:null,onCreateItem:null,onSelect:null,values:["value","url","label","type"],pattern:'<a href="%url%"><span class="info">%type%</span>%label%</a>',name:"autoComplete",disableClass:"disabled",autoWidth:true,delay:400};var i=function(e,t,r){n.oInput=e;if(n.oInput.hasClass(r.disableClass)){h()}else{var i=n.oInput.val();if(i.length>=r.minLength){var o=r;clearTimeout(n.typingTimer);n.typingTimer=setTimeout(function(){s(i,o)},o.delay);p(t,r)}else if(null!=n.oList){h()}}};var s=function(r,i){if(n.oldText!=r&&false==n.oInput.hasClass(n.tempSelectionClass)){n.oldText=r;t.ajax({url:i.source+"?term="+encodeURI(r),dataType:"json"}).done(function(r){if(r!=null&&r.length>0){var s=n.oList==null?o(i):n.oList;s.html("");t.each(r,function(r,o){var u=i.pattern;for(var a=0;a<i.values.length;a++){var f=new RegExp("%"+i.values[a]+"%","g");u=u.replace(f,o[i.values[a]])}var l=t("<li>"+u+"</li>");l.data("val",o[i.values[0]]);l.data("values",o);var c=i;l.click(function(e){n.oInput.val(t(e.currentTarget).data("val"));if(t.isFunction(c.onSelect)){c.onSelect(e,l)}});if(t.isFunction(i.onCreateItem)){i.onCreateItem(e,l)}l.appendTo(s)});s.show()}})}};var o=function(e){var r=t('<ul id="'+e.name+'"/>');var i=t("body");i.append(r);var s=n.oInput;r.css({position:"absolute",top:s.offset().top+s.height(),left:s.offset().left,display:"block"});if(true===e.autoWidth){r.css({width:s.outerWidth()})}n.oList=r;if(t.isFunction(e.onCreate)){e.onCreate(r)}i.on("click",function(e){l(e)});return r};var u=function(){n.oList.show();if(n.oSelected==null){n.oSelected=n.oList.find("li").first()}else{var e=n.oSelected.removeClass("selected").next();if(n.oSelected.length>0){n.oSelected=e}else{n.oSelected=n.oList.find("li").first()}}n.oSelected.addClass("selected");if(undefined!=n.oSelected.data("val")){n.oInput.addClass(n.tempSelectionClass).val(n.oSelected.data("val"))}};var a=function(){n.oList.show();if(n.oSelected==null){n.oSelected=n.oList.find("li").last()}else{var e=n.oSelected.removeClass("selected").prev();if(n.oSelected.length>0){n.oSelected=e}else{n.oSelected=n.oList.find("li").last()}}n.oSelected.addClass("selected");if(undefined!=n.oSelected.data("val")){n.oInput.addClass(n.tempSelectionClass).val(n.oSelected.data("val"))}};var f=function(){n.oInput.removeClass(n.tempSelectionClass)};var l=function(e){if(null!=n.oInput&&e.target!=n.oInput.get(0)){h()}};var c=function(){n.oInput.removeClass(n.tempSelectionClass).val(n.oldText)};var h=function(){if(n.oList!=null){n.oList.hide()}if(n.oSelected!=null){n.oSelected.removeClass("selected");n.oSelected=null}};var p=function(e,r){var i=e.which;switch(i){case n.keys.ESC:clearTimeout(n.typingTimer);c();h();break;case n.keys.DOWN:clearTimeout(n.typingTimer);u();break;case n.keys.UP:clearTimeout(n.typingTimer);a();break;case n.keys.TAB:case n.keys.RETURN:clearTimeout(n.typingTimer);if(t.isFunction(r.onSelect)&&null!=n.oSelected){e.preventDefault();var s=n.oSelected;r.onSelect(e,s)}h();break;default:f();break}};var d=function(e,t){if(n.keys.ESC==e.which&&null!=n.oList){clearTimeout(n.typingTimer);c();h()}};t.fn.autoComplete=function(e){var n=t.extend(r,e);t(this).on("keyup",function(e){i(t(this),e,n)});t(this).on("keypress",function(e){d(e,n)});return this}})(jQuery)
